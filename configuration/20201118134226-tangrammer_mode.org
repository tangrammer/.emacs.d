#+title: tangrammer-mode

[[file:20201028091004-transient_mode.org][transient-mode]]


** go to a directory using a predefined alias

   interesting the pattern matching example 
#+BEGIN_SRC emacs-lisp :results silent 

(define-transient-command tangrammer/dir/go/data-science-command ()
  "Data-science related things"
  ["Actions"
   ("g" "general"
    (lambda (&optional args)
      (interactive)
      (find-file  "~/git/akvo/data-science/akvo-data-science-services")))
   ("l" "example-lumen"
    (lambda (&optional args)
      (interactive)
      (find-file  "~/git/akvo/data-science/akvo-data-science-services/projects/example-lumen")))
   ("o" "example-local"
    (lambda (&optional args)
      (interactive)
      (find-file  "~/git/akvo/data-science/akvo-data-science-services/projects/example-local")))
   ])

(define-transient-command tangrammer/dir/go/lumen-command ()
  "Lumen related dirs"  
  ["Actions"
   ("c" "client" (lambda (&optional args)
                          (interactive)
                          (find-file  "~/git/akvo/akvo-lumen/client/")))
   ("b" "backend" (lambda (&optional args)
                          (interactive)
                          (find-file  "~/git/akvo/akvo-lumen/backend/project.clj")))])

(define-transient-command tangrammer/dir/go/emacs ()
  "Emacs related things"
  ["Actions"
   ("c" "configuration" (lambda (&optional args)
                          (interactive)
                          (find-file  "~/.emacs.d/configuration")))
   ("i" "init.el" (lambda (&optional args)
                    (interactive)
                    (find-file  "~/.emacs.d/init.el")))])

(define-transient-command tangrammer/dir/go-command ()
  "tangrammer dir go dispatcher"
  ["Actions"
   ("d" "data-science related" tangrammer/dir/go/data-science-command)
   ("l" "lumen related" tangrammer/dir/go/lumen-command)
   ("e" "emacs related" tangrammer/dir/go/emacs)])
     #+END_SRC

** tangrammer transient options

#+BEGIN_SRC emacs-lisp :results silent 

(defun populate-babel-source-block  (name v1)
  (flet ((dummy-prompt
          (prompt choices &optional display-fn)
          (declare (ignore prompt))
          (or (find name choices :key display-fn :test #'string=)
              (throw 'notfound nil))))
    (let ((yas/prompt-functions '(dummy-prompt)))
      (catch 'notfound
        (yas/insert-snippet t)
        (insert v1)
        (execute-kbd-macro [?\t]) ;;(insert ?\t)	
        ))))

(defun tangrammer/babel/block-action (&optional args)
  (interactive
   (list (transient-args 'tangrammer/babel/block-generator-command)))
  (message "%s" args)
  (-let (((a b) (->>
                 args
              (--map (split-string it "="))
              (--separate (string= "language" (first it))))))
    (-if-let  (language (-first-item a))      
        (populate-babel-source-block "block" (--reduce-from (concat acc " " it) (-last-item language) (--map (format ":%s %s" (-first-item it) (-last-item it)) b)))
      (message "you need to select a language!"))))

(transient-define-argument tangrammer/babel/language-argument ()
  "language"
  :description "choose a language"
  :class 'transient-option
  :shortarg "-l"
  :argument "language="
  :choices '("sql" "elisp" "clojure" ))

(transient-define-argument tangrammer/babel/exports-argument ()
  "exports doc"
  :description "define how to export code"
  :class 'transient-option
  :shortarg "-e"
  :argument "export="
  :choices '("none" "code" "results" "both" ))

(transient-define-argument tangrammer/babel/eval-argument ()
  "eval doc"
  :description "define how to eval code"
  :class 'transient-option
  :shortarg "-v"
  :argument "eval="
  :choices '("query" "query-export" "never" "never-export" ))

(defun tangrammer/co-authored-action (&optional args)
  (interactive
   (list (transient-args 'tangrammer/co-authored-command)))
  (message "%s" args)
  (if (-contains? args "multiple")
      (call-interactively 'co-authored-multiple)
    (call-interactively 'co-authored)))

(define-transient-command tangrammer/co-authored-command ()
  "Test Transient Title"
  ["Arguments"
   ("m" "multiple authors" "multiple")]
  ["Actions"
   ("c" "Co-Authored-BY" tangrammer/co-authored-action)])

(define-transient-command tangrammer/git-command ()
  "Git related things"
  ["Actions"
   ("c" "Co-Authored-BY" tangrammer/co-authored-command)])

(define-transient-command tangrammer/babel/block-generator-command ()
  "Babel related things"
  ["Arguments"
     ("l" "language" tangrammer/babel/language-argument)
     ("e" "exports" tangrammer/babel/exports-argument)
     ("v" "eval" tangrammer/babel/eval-argument)
     ]
  ["Actions"
   ("c" "gen-block" tangrammer/babel/block-action)])

(define-transient-command >t ()
  "tangrammer dispatcher"
  ["Actions"
   ("b" "babel things" tangrammer/babel/block-generator-command)
   ("r" "roam(s)" tangrammer/roam/go)
   ("d" "go to 'my' dirs" tangrammer/dir/go-command)
   ("m" "git related" tangrammer/git-command)])

#+END_SRC
